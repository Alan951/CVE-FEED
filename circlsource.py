import requests

class CirclSource():

    def setCVEList(self, cveList):
        self.inputCveList = cveList

    def process(self, opts = None):
        result = []
        for cve in self.inputCveList:
            r = self.reqApi(cve)
            result.append(r)

        return result

    def reqApi(self, cve):
        url = 'https://cve.circl.lu/api/cve/{}'.format(cve)
        r = requests.get(url)
        if(r.status_code != 200 or r.json() == None):
            print('Error al intentar consultar por el CVE {}. Response HTTP != 200 or Result != Json'.format("cve"))
            return {
                "cve": cve,
                "found": False
            }
        
        r = r.json()
        d = self.extractGoldData(r)

        result = {
            "cve": cve,
            "found": True,
        }

        for k, v in d.items():
            result[k] = v

        return result

    def extractGoldData(self, data):
        return {
            "cvss": data['cvss']
        }
    
if __name__ == "__main__":
    src = CirclSource()
    src.setCVEList(['CVE-2020-0123', 'CVE-2019-12289', 'CVE-2019-11331', 'CVE-2019-0123', 'CVE-2018-8869'])
    src.process()